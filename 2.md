# Лабораторная работа №2. Простейший чат-бот в Telegram

<ins>Цель</ins>: получение навыков работы с библиотекой Aiogram, связка API OpenAI и написанного бота.

## План

1. Настройка окружения;
2. Написание основных функций бота;
3. Задания.

---

## 1. Мы сделали всю базу которая была в примере и получилось вот это 

<img width="1183" height="1000" alt="image" src="https://github.com/user-attachments/assets/795c66b4-c8f6-40a6-8655-9ae2439713fe" />

Мы создали простого бота который имеет кнопку старта и может отвечать на вопросы.

Далее по заданиям нужно было реализовать 
3. Нажать на кнопку `Create new bot`;

![Создание нового бота](photos/lab2/botfather_new_bot_creation.png)

4. Ввести имя бота и его адрес (опционально можно задать описание и фото). Адрес обязательно должен кончаться на `bot`;
5. Нажать на кнопку `Create bot`;

6. В окне с информацией о боте получить токен бота;

![Токен бота](photos/lab2/botfather_new_bot_info.png)

7. Создадим базовую команду `/start`. Для этого в меню бота перейдем во вкладку `Commands` и заполним обязательные поля, после чего нажмем на кнопку `Add`;

![Команда /start](photos/lab2/botfather_new_command.png)

Создав бота и получив токен, можно приступать к формированию файла с переменными окружения. В папке проекта создайте файл `.env` и скопируйте в него токен бота. Из прошлой лабораторной работы мы знаем, что для создания ассистента нам нужен API-ключ от OpenAI. Внесите его в файл `.env`.
```plaintext
BOT_TOKEN=your-bot-token-here
OPENAI_API_KEY=your-api-key-here
```

По аналогии с предыдущей лабораторной работой создадим виртуальное окружение и установим библиотеки.
```bash
python -m venv venv
```
```bash
venv\Scripts\activate
```
```bash
pip install aiogram openai python-dotenv
```

Создадим файл `requirements.txt` и скопируем в него список установленных библиотек.
```bash
pip freeze > requirements.txt
```



## 2. Задания делаем

Далее по заданиям нужно было реализовать:
-Добавить системный промт, я просто его написала в `.env`.
<img width="576" height="23" alt="image" src="https://github.com/user-attachments/assets/e3f5aeaf-160e-4259-b593-0f546f0c4af1" />
-Следующее задание было реализовать обращение по имени к пользователю
сделала я это тут вот так 
```python
@dp.message(CommandStart())
async def command_start_handler(message: Message) -> None:
    try:
        user = await get_user(message)

        text = (
            f"Привет, <b>{user.full_name}</b>! Я бот-ассистент Крысиный король Ратистор.\n"
            f"Пиши вопросы — может я отвечу.\n\n"
            f"Команды:\n"
            f"/reset-context — сбросить контекст"
        )

        await message.answer(text)

    except Exception as e:
        logging.exception("Start handler error")
        await message.answer("Ошибка в /start")
```


## 3. Задания

1. Добавьте к ассистенту системный промпт;
2. Сделайте так, чтобы бот знал имя пользователя и при ответе обращался к нему по имени;
3. Добавьте хранение сообщений (добавьте базу данных);
4. Добавьте поддержку контекста диалога (используйте базу данных из задания 3);
4. Добавьте команду `/reset-context`, которая будет сбрасывать контекст диалога;
5. Добавьте поддержку отправки изображений (без их обработки нейронкой, в реплае просто текстом отвечайте, что "Вы отправили картинку!").

---


